# mysql锁

## 一、概述

作用：数据库并发

划分：

* 粒度

  * 表锁

  * 页锁

  * 行锁

* 类型
  * 共享锁（读锁、S锁）
  * 排他锁（独占锁、X锁）
  * 意向排他锁（IX）表锁
  * 意向共享锁（IS）

## 二、粒度划分

### 2.1  表锁

* 引擎默认锁：Myisam
* 优点：对整张表枷锁、开销小加锁快、无死锁
* 缺点：锁粒度大，发生锁冲突该路极高，并发性低
* 其它：Myisam的读写锁调度是写优先，这也是Myisam不适合 做主表的引擎，因为写锁后，其他线程不能做任何操作，大量的更新使查询很难得到锁，从而造成永远堵塞（待处理）
* 锁的种类

### 2.2 行锁

* 引擎默认锁：Innodb

* 优点：锁粒度最小，发生锁冲突和概率最低，并发度最高

* 缺点：开销大、加锁慢、会出现死锁（待处理）

  

### 2.3 页锁

开销、加锁时间和锁粒度介于表锁和行锁之间，会出现死锁

## 三、 事务并发带来的问题

* 更新丢失
* 脏读
* 不可重复读
* 幻读

## 四、锁类型以及上锁语法

### 4.1 全局锁

将整个数据库设置为只读状态，用来做全库的逻辑备份。

* 语法：

  * ```mysql
    FLUSH TABLES WITH READ LOCK
    ```

* 分析（待处理）

### 4.2 表锁

表锁有三种：表锁、元数据锁（Meta Data Lock，MDL）、意向锁

* 语法：

  * ```mysql
    --上表的读写锁
    lock table 表名 read/write;
    ```

    
